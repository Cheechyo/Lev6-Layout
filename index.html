<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Lev6</title>

    <!-- flat-ui -->
    <link rel="stylesheet" charset="utf-8" href="bower_components/flat-ui/dist/css/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" charset="utf-8" href="bower_components/flat-ui/dist/css/flat-ui.css" rel="stylesheet">

    <!-- common, index etc.. -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/table.css">

    <!-- icon font -->
    <link href="http://cdn.materialdesignicons.com/1.6.50/css/materialdesignicons.min.css" media="all" rel="stylesheet">

    <script src="bower_components/flat-ui/dist/js/vendor/jquery.min.js"></script>
    <script src="bower_components/three.js/build/three.min.js"></script>
    <script src="bower_components/three.js/examples/js/libs/tween.min.js"></script>
    <script src="bower_components/three.js/examples/js/renderers/CSS3DRenderer.js"></script>
    <script src="bower_components/lodash/dist/lodash.min.js"></script>
    <script>
      Math.randomRange = function(max, min){
        min = min || 0;

        return Math.round(Math.random() * (max - min)) + min;
      };

      var camera = new THREE.PerspectiveCamera(40, 1.5, 1, 1000);
      camera.position.z = 600;
      camera.aspect = 1.5;
      camera.updateProjectionMatrix();

      var scene = new THREE.Scene();

      var renderer = new THREE.CSS3DRenderer();
      renderer.setSize(600, 400);

      var assigned = {
        'physical_education': {
          icon: 'mdi mdi-dribbble red-text',
          text: '체육'
        }
      };

      var cards = {
        1: 'physical_education',
        2: 'physical_education',
        3: 'physical_education',
        4: 'physical_education',
        5: 'physical_education',
        6: 'physical_education',
        7: 'physical_education'
      };

      var cardObjects = [];
      var moveTarget = [];
      var animateDuration = 2000;

      _.forEach(cards, function(v, period){
        var elem = $(document.createElement('div')).addClass('gg card')
          .append(
            $(document.createElement('h2'))
              .append($(document.createElement('i')).addClass(assigned[v].icon))
          )
          .append(
            $(document.createElement('h7')).text(period + '교시 ' + assigned[v].text)
          );

        var object = new THREE.CSS3DObject(elem.get(0));

        //Randomize Object position
        object.position.x = Math.randomRange(-300, 300);
        object.position.y = Math.randomRange(300, -300);
        object.position.z = Math.randomRange(-300, 300);

        object.rotateX(Math.randomRange(0, 360));
        object.rotateY(Math.randomRange(0, 360));
        object.rotateZ(Math.randomRange(0, 360));

        cardObjects[period] = object;
        moveTarget[period] = {
          position: {
            x: period * 200 - 750, //FIXME
            y: 0, //FIXME
            z: 0
          },

          rotation: {
            x: 0,
            y : 0,
            z : 0
          }
        };

        scene.add(object);
      });

      function animate(){
        requestAnimationFrame(animate);
        TWEEN.update();
      }

      function startAnimation(){
        TWEEN.removeAll();
        Object.keys(cardObjects).forEach(function(k){
          var object = cardObjects[k];
          var target = moveTarget[k];

          new TWEEN.Tween(object.position)
            .to(target.position, animateDuration)
            .easing(TWEEN.Easing.Quintic.In)
            .start();

          new TWEEN.Tween(object.rotation)
            .to(target.rotation, animateDuration)
            .easing(TWEEN.Easing.Quintic.In)
            .start();
        });

        new TWEEN.Tween(this)
          .to({}, animateDuration)
          .onUpdate(function(){
            console.log("Tweening");
            renderer.render(scene, camera);
          })
          .start();
      }

      animate();

      $(document).ready(function(){
        var renderView = $(renderer.domElement);
        renderView.css({
          width: '100%'
        });
        $('.timetable').append(renderView);
        startAnimation();
      });
    </script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-9">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand">
          <i class="mdi mdi-calendar-today"></i>
          <span>Lev6</span>
        </a>
      </div>

      <div class="navbar-collapse collapse" id="navbar-collapse-9">
        <ul class="nav navbar-nav">
          <li>
            <a href="http://seogwipo.hs.kr" target="_blank">
              <i class="mdi mdi-school"></i>
              <span>서귀포고</span>
            </a>
          </li>
          <li class="active">
            <a href="issue">
              <i class="mdi mdi-flag"></i>
              <span>문의</span>
            </a>
          </li>
          <li>
            <a>
              <i class="mdi mdi-clock"></i>
              <span id ='time'></span>
            </a>
          </li>
        </ul>

        <script type="text/javascript">
          function startTime() {
            var today = new Date();
            var h = today.getHours();
            var m = today.getMinutes();
            var s = today.getSeconds();

            m = checkTime(m);
            s = checkTime(s);
            document.getElementById("time").innerHTML = h + ":" + m;
            setTimeout(function () {
              startTime()
            }, 500);
          }

          // 10보다 작을때 앞에 0 생성
          function checkTime(i) {
            if (i < 10) {
              i = "0" + i;
            }
            return i;
          }

          startTime();
        </script>

        <form class="navbar-form navbar-right visible-lg" role="form">
          <div class="form-group">
            <input type="text" placeholder="Email" class="form-control">
            <input type="password" placeholder="Password" class="form-control">
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="mdi mdi-account"></i>
            <span>로그인</sapn>
          </button>
        </form>

        <div class="navbar-right navbar-form hidden-lg">
          <button class="btn btn-primary" href="#!">
            <i class="mdi mdi-account"></i>
            로그인
          </button>
        </div>
      </div>
    </nav>

    <main class="section bg" id ="top">
      <ul class="nav nav-tabs">
        <li role="presentation" class="active">
          <a href="#1grade">
            <i class="mdi mdi-face"></i>
            <span>1학년</span>
            <span class="sr-only"> (current)</span>
          </a>
        </li>
        <li role="presentation">
          <a href="#2grade">
            <i class="mdi mdi-face"></i>
            <span>2학년<span>
          </a>
        </li>
        <li role="presentation">
          <a href="#3grade">
            <i class="mdi mdi-face"></i>
              <span>3학년</span>
            </a>
        </li>
      </ul>

      <div class="row grid timetable">

      </div>
    </main>

    <main class="section" style="height: 350px">
      <ul class="list-group meals">
        <h6><i class="mdi mdi-beer"></i></h6>
        <span class="breadcrumb">
          <li><a href="#">아침</a></li>
          <li><a href="#">점심</a></li>
          <li class="active">저녁</li>
        </span>
        <li class="list-group-item">
          <span class="badge">난류</span>
          계에에란
        </li>
        <li class="list-group-item">
          <span class="badge">난류</span>
          계에에란
        </li>
        <li class="list-group-item">
          <span class="badge">난류</span>
          계에에란
        </li>
        <li class="list-group-item">
          <span class="badge">난류</span>
          계에에란
        </li>
      </ul>
    </main>

    <div class"footer">
      <div class="container">
        <div class="row-container warp">
          <div class="col col-sm-12 credit" style="margin: 0 auto; text-align:center;">
            <img class="img-circle" src="img/team-railgun.png">
            <h5>
              Project Lev6 <p>copyright(C) Team-railgun<p>
            </h5>
          </div>
        </div>
      </div>
    </div>
    <script src="bower_components/flat-ui/dist/js/flat-ui.js"></script>
  </body>
</html>
